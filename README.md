# elves-shoemaker
**スタック管理型・ローカルLLM自律エージェント制御基盤**

## 命名の由来
「小人の靴屋」のように、人間が寝ている間に背後でタスクを1つずつ片付け、朝には靴（成果物）を完成させているような自律存在を目指して命名しました。

## 仕組み：1つずつ、確実に進める
本システムは「今、何をすべきか」を管理する**スタック**と、具体的な作業を行う**ツール**だけで動きます。

1. **迷わない**: 過去の全履歴をダラダラ送らず、「今の目標」と「さっきの結果」だけをLLMに渡して次の一手を決めさせます。
2. **分解して進む**: 大きな問題は、その場で小さな作業に切り分けてスタックに積み、1つずつ処理します。
3. **やり直せる**: 毎回「終わったかどうか」を判定するため、失敗しても自動で原因を探り、修正プロセスに戻ります。

## 動作フロー（擬似コード）
ループのたびに状況をリセットして判断するため、エラーに強く、安定して自走します。

``typescript
while (taskStack.isNotEmpty()) {
  // 1. 次にやるべき「ツールの名前」を決定
  const effectName = await orchestrator.selectNextEffect();

  // 2. そのツールを動かすための「具体的な引数」を生成
  // (余計な解説を省き、壊れたJSONを修復してパースする)
  const args = await orchestrator.generateArgs(effectName);

  // 3. 実行してスタックやファイルを更新
  const result = await orchestrator.dispatch(effectName, args);

  // 4. 結果を「最新の事実」として保存し、次のループへ
  orchestrator.recordObservation(result);
}
``

## 主なツール（Effects）
- **`task.check`**: 目標を達成したか判定。合格ならその作業を完了（Pop）とする。
- **`task.plan`**: 解決に向けた具体的な戦略を立てる。
- **`task.split`**: 戦略を小さな作業単位に切り出し、スタックに積む。
- **`web.notify`**: Discord等で進捗を報告する。
- **`file.write / grep`**: ファイルを直接読み書きする。

## 特徴
- **リソース節約**: 情報を整理して送るため、16GB vRAM環境でも動作が重くなりません。
- **JSON自動修復**: ローカルLLMが吐き出す「お喋りなJSON」からデータだけを救出して実行します。
- **完全ローカル**: 外部APIを使わず、データ流出のリスクなしで無限に試行錯誤が可能です。

## 動作要件
- **vRAM 16GB以上** (RTX 3060 / 4060 Ti等)
- **LM Studio**
- **Node.js**

## ライセンス
- [MIT](./LICENSE)

## 開発者 / Author
- [おんJ民](https://github.com/onjmin)
